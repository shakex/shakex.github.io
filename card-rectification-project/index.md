# 身份证图像透视校正算法




> 这是去年在公司实习的项目，把自己的分割模型完（sheng）美（ying）迁移到了边缘检测上。因为没有及时填坑，很多细节可能有点遗忘。

## 问题

要求是实现一个微信小程序的算法接口，针对用户随手拍摄上传的身份证正反面图像进行透视校正，并按校正结果原图输出，用于身份证件的快速复印。



实现的效果大概就是这样：

![](https://tva1.sinaimg.cn/large/008eGmZEgy1gngaun6orpj30lf09111m.jpg)

## 基本思路

这个问题毛估估一想好像并不难，OpenCV中的`four_point_transform`已经帮我们实现好了透视变换，我们只要把卡片的四个角点定位出来就完事了嘛。四个角点的定位也不难：`find_coutours`



但仔细分析一下，要实现输出可用于直接打印（不含图像后期增强等处理）的图像，想到四个需要解决的点：

- 卡片的四角为圆角，用定位出来的四个角点或有偏差，会导致透视变换后的

- 背景复杂

- 拍摄可能存在部分遮挡的情况
- 如何对校正图像，





## 整体流程

![image-20210208190559585](https://tva1.sinaimg.cn/large/008eGmZEgy1gngc1l49xej31hq0qcu0x.jpg)

**算法流程**：对于输入图像，经过四个模块处理，最终得到校正后的图像。四个模块分别为：边缘检测模块、直线检测模块、透视变换模块和后处理模块。四个主要模块的功能及主要实现方法如下：

- **边缘检测模块**：该模块的功能是通过图像得到身份证卡片的边缘。边缘图像用二值图表示，其中白色为前景（即身份证边缘轮廓），黑色为背景。算法采用两种方法进行边缘检测，第一种方法训练了一种边缘网络；第二种方法运用了基于Canny的边缘检测方法。在第一种方法无法检测得到卡片边缘的情况下（无法检测出全部四条直线边），将采用第二种方法。
- **直线检测模块**：该模块的功能是通过边缘二值图得到身份证卡片的四条直线边，从而进一步获得身份证四个角点的坐标。算法采用Hough直线变换，对于一次检测出来的多条直线，再选取符合度最高的四条直线边，两两求出其交点，即得到卡片的四个角点。
- **透视变换模块**：该模块的功能是通过身份证四个角点坐标，利用透视变换原理对图像进行透视校正，得到校正后图像。
- **后处理模块**：该模块的功能是校正后图像做进一步优化处理，如卡片倒角、旋转变换、长宽压缩等，最后输出符合要求的身份证图像。

## 边缘检测



### Canny边缘检测
![图源：[^1]](https://tva1.sinaimg.cn/large/008eGmZEgy1gngcaozymdj30rs112b29.jpg)



### 模型选择

### 边缘检测网络

### Loss



## 直线检测





## 透视变换





## 后处理





## 总结




[^1]: 图片来源：http://fengjian0106.github.io/2017/05/08/Document-Scanning-With-TensorFlow-And-OpenCV/
